<style> 

	#textcompletion-button {
		margin-bottom: 5px; 
		background-color: rgb(181, 101, 29); 
		border: 1px solid black; 
		border-radius: 5px; 
		box-shadow: 0 -1px 2px 0 rgba(0,0,0,.15); 
		font-style: italic;
		box-shadow:
			inset 0 0 2px 0 rgba(255,255,255,.4),
			inset 0 0 3px 0 rgba(0,0,0,.4),
			inset 0 0 3px 5px rgba(0,0,0,.05),
			2px 2px 4px 0 rgba(0,0,0,.25);
		padding: 6px 8px 6px 8px;
		text-shadow: 0 0 2px rgba(255,255,255,.3);
		color: white;
		transition: 0.3s;
	}
	
	#textcompletion-button:hover {
		background-color: rgb(201, 121, 49); 
	}
	
	#textcompletion-errortext {
		color: red;
		visibility: hidden;
	}
	
	</style>
	<p id="textcompletion-errortext"> Something went wrong! try again later... </p>
	<button id="textcompletion-button"> Text Completion </button>
	<script>
	
	// Function to get cart contents in json format
	async function getCart() {
		const result = await fetch("/cart.json");

		if (result.status === 200) {
			return result.json();
		}

		throw new Error(`Failed to get request, Shopify returned ${result.status} ${result.statusText}`);
	}
	
	// Function called when button is pressed
	$("#textcompletion-button").click(async () => {
										
		// Gets cart
		let cart = await getCart();
	
		// Sends cart to server
		$.post("https://655d9baeecaf.ngrok.io/ajax/generate-checkout", cart, function( data ) {
			
			// Server responds with checkout link and randomized code
			let link = data.link;
			let error = data.error;
			console.log("Here is the link: ", link, error)
			
			// Redirects to checkout link if link is not null, otherwise shows error
			if (link) {
				window.location = link;
			} else {
				$("#textcompletion-errortext").css("visibility", "visible");
			}
			
		}, "json");
	});
    
</script>